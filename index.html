<!DOCTYPE html>
<html>
<head>
  <title>News Minimalist Reader</title>
  <meta charset="utf-8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="News Minimalist Reader" />
  <meta name="theme-color" content="#000A16" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#FFFFFF" media="(prefers-color-scheme: light)" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="icon" href="favicon.png" />
  <link rel="stylesheet" href="index.css" />
  <link rel="apple-touch-icon" href="appicon.png" />
</head>
<body>
  <script>
    const parser = new DOMParser()
    const getText = (item, tag) => item.getElementsByTagName(tag)[0].textContent

    const onClick = (guid) => ({ target }) => {
      localStorage.setItem(guid, 'x')
      target.getElementsByTagName('summary')[0].classList.remove('unread')
    }

    fetch('https://nameless-bread-889b.jbonigomes.workers.dev/')
      .then((response) => response.text())
      .then((text) => {
        const doc = parser.parseFromString(text, 'application/xml')
        const items = doc.getElementsByTagName('item')

        document.body.innerHTML = [...items].map((item) => `
          <details name="feed" ontoggle="onClick('${getText(item, 'guid')}')(event)">
            <summary class="${localStorage.getItem(`${getText(item, 'guid')}`) ? '' : 'unread'}">
              ${getText(item, 'title')}
            </summary>
            <p>
              ${getText(item, 'content:encoded')}
            </p>
          </details>
        `).join('')
      })
  </script>
</body>
</html>
